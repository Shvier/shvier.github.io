<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#faf6f1 lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Proof of Solvency with zk SNARKs, Re-explained - Barry's Site</title><meta name=theme-color><meta name=description content="This is a re-exposition of Vitalik&rsquo;s customized IOP about proof of solvency. The protocol was intuitive when I first read it, so I didn&rsquo;t think about the details thoroughly. When I was designing a protocol of proof of solvency, I wanted to compare the pros and cons of the existing designs. So this post came out.
KZG commitment KZG is one of the most prevalent polynomial commitments. It is widely used in generating proof of zero knowledge."><meta name=author content="Barry's Site"><link rel="preload stylesheet" as=style href=https://shvier.github.io/main.min.css><script defer src=https://shvier.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://shvier.github.io/theme.png><link rel=preload as=image href=https://shvier.github.io/twitter.svg><link rel=preload as=image href=https://shvier.github.io/github.svg><link rel=icon href=https://shvier.github.io/favicon.ico><link rel=apple-touch-icon href=https://shvier.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.111.3"><meta property="og:title" content="Proof of Solvency with zk SNARKs, Re-explained"><meta property="og:description" content="This is a re-exposition of Vitalik&rsquo;s customized IOP about proof of solvency. The protocol was intuitive when I first read it, so I didn&rsquo;t think about the details thoroughly. When I was designing a protocol of proof of solvency, I wanted to compare the pros and cons of the existing designs. So this post came out.
KZG commitment KZG is one of the most prevalent polynomial commitments. It is widely used in generating proof of zero knowledge."><meta property="og:type" content="article"><meta property="og:url" content="https://shvier.github.io/posts/2023/0718/proof-of-solvency-with-zk-snark/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-17T17:01:02-04:00"><meta property="article:modified_time" content="2023-07-19T03:20:11+00:00"><meta itemprop=name content="Proof of Solvency with zk SNARKs, Re-explained"><meta itemprop=description content="This is a re-exposition of Vitalik&rsquo;s customized IOP about proof of solvency. The protocol was intuitive when I first read it, so I didn&rsquo;t think about the details thoroughly. When I was designing a protocol of proof of solvency, I wanted to compare the pros and cons of the existing designs. So this post came out.
KZG commitment KZG is one of the most prevalent polynomial commitments. It is widely used in generating proof of zero knowledge."><meta itemprop=datePublished content="2023-07-17T17:01:02-04:00"><meta itemprop=dateModified content="2023-07-19T03:20:11+00:00"><meta itemprop=wordCount content="485"><meta itemprop=keywords content="Solvency,SNARK,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Proof of Solvency with zk SNARKs, Re-explained"><meta name=twitter:description content="This is a re-exposition of Vitalik&rsquo;s customized IOP about proof of solvency. The protocol was intuitive when I first read it, so I didn&rsquo;t think about the details thoroughly. When I was designing a protocol of proof of solvency, I wanted to compare the pros and cons of the existing designs. So this post came out.
KZG commitment KZG is one of the most prevalent polynomial commitments. It is widely used in generating proof of zero knowledge."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://shvier.github.io/>Barry's Site</a><div class="btn-dark text-[0] ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#faf6f1"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/about/>About</a></nav><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./twitter.svg) href=https://twitter.com/shvier1894 target=_blank rel=me>twitter</a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/Shvier target=_blank rel=me>github</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-16 pb-24 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">Proof of Solvency with zk SNARKs, Re-explained</h1><div class="text-sm opacity-50" style=display:flex;align-items:center><time>Created on Jul 17, 2023</time>
<time>&nbsp•&nbspModified on Jul 19, 2023</time></div></header><section><p>This is a re-exposition of <a href=https://vitalik.ca/general/2022/11/19/proof_of_solvency.html#improving-privacy-and-robustness-with-zk-snarks>Vitalik&rsquo;s customized IOP</a> about proof of solvency. The protocol was intuitive when I first read it, so I didn&rsquo;t think about the details thoroughly. When I was designing a protocol of proof of solvency, I wanted to compare the pros and cons of the existing designs. So this post came out.</p><h2 id=kzg-commitment>KZG commitment</h2><p>KZG is one of the most prevalent polynomial commitments. It is widely used in generating proof of zero knowledge. How can we do that? A polynomial commitment is a &ldquo;hash&rdquo; of a function. The prover converts the problem into one or several polynomials and commits to them, i.e., hashes the polynomials, and sends them to the verifier. Then the verifier randomly chooses a challenge and replies to the prover. The prover computes the result at the challenge point and reveals it to the verifier. If the result matches with the value computed from the commitment, the prover proves he knows the polynomial, that is, the solution to the problem. In this and the original article, the polynomial commitment is denoted by \(P(x)\).</p><h2 id=auxiliary-polynomial>Auxiliary polynomial</h2><p>Vitalik introduced an auxiliary polynomial \(I(x)\) to build the proving system. Specifically, the following equations hold to prove the solvency (strictly speaking, it is proof of liability):</p><ul><li>\(I(z^{16x})=0\)</li><li>\(I(z^{16x+14})=P(\omega^{2x+1})\)</li><li>\(I(z^i)-2*I(z^{i-1})\in\{0,1\},\text{ if }i\mod{16}\notin\{0,15\}\)</li><li>\(I(z^{16x+15})=I(z^{16x-1})+I(z^{16x+14})-{\text{the declared total}\over\text{user count}}\)</li></ul><p>Let us check out these equations one by one.</p><ol><li>\(I(z^{16x})=0\) and \(I(z^i)-2*I(z^{i-1})\in\{0,1\}\) proves that \(I\) stores the binary bits of each balance, which is assumed under \(2^{15}\). \(I(z^{16x})=0\) is not mandatory to achieve proof of liability. What it makes is ensuring the balance is exactly lower than \(2^{15}\). If we omit this equation, the range constraint will be \(2^{15}+1\).</li><li>\(I(z^{16x+14})=P(\omega^{2x+1})\) is actually a copy constraint, which makes all balances the same as those in the original data set. For example, \(P(\omega^3)=50\) and \(I(z^{30})=50\) when \(x=1\).</li><li>The last equation is the most tricky part of this proposal. From the original post, the declared total is \(1480\), and the user count is \(8\). Let \(x=1\), we have \(I(z^{31})=-300,I(z^{15})=-165,I(z^{30})=50\), which satisfies the equality. That is, <code>every 16th position tracks a running total with an offset so that it sums to zero</code> comes from. However, I have to point out the prover can choose an arbitrary value instead of the actual amount, which still can pass the verifying process. Since exchanges always want to lower their liabilities to prove they have enough funds, they do not have any reason to increase the amount. For example, if we change the declared total to 1000, \(I(z^{14})=20,I(z^{15})=-105,I(z^{30})=50,I(z^{31})=-35\), the equation still holds. But it can be easily mitigated by adding a constraint that \(I(z^x)\gt 0\).</li></ol><h2 id=related-work>Related work</h2><p>The biggest issue of the proposal is that it requires a big trusted setup, fully described in this <a href=https://ethresear.ch/t/snarked-merkle-sum-tree-a-practical-proof-of-solvency-protocol-based-on-vitaliks-proposal/14405#very-large-trusted-setup-9>post</a>.</p><p>One of the optimizations is separating the users into several groups, and we generate the proof of liability for each group, then compute the proof of each group&rsquo;s liability.</p></section><footer class="mt-12 flex flex-wrap"><a class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]" href=https://shvier.github.io/tags/solvency>Solvency</a>
<a class="mr-1.5 mb-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]" href=https://shvier.github.io/tags/snark>SNARK</a></footer><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]"><a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://shvier.github.io/posts/2023/0227/prerequisites-for-zkp/><span>Prerequisites for Zero-Knowledge Proof</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-50"><div class=mr-auto>&copy; 2023
<a class=link href=https://shvier.github.io>Barry's Site</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Theme Paper</a>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css integrity="sha512-mQwom8Ns4op+H29oDkD/LXO/OsXPvCFfkgZkFAVrhhePzRLU8NUI3Nkm43NhWUSmj3p5Cca2HTEkMQmXQRwDQQ==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js integrity="sha512-sHSNLECRJSK+BFs7E8DiFc6pf6n90bLI85Emiw1jhreduZhK3VXgq9l4kAt9eTIHYAcuQBKHL01QKs4/3Xgl8g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script></footer></body></html>